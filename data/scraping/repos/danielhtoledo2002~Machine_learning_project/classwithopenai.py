# -*- coding: utf-8 -*-
"""classwithOPENAI.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1FMsbc6GGIMlsRio4R2WrpL3OhsI9IpnT
"""

from google.colab import drive
drive.mount('/content/gdrive')

import pandas as pd

df = pd.read_csv('/content/gdrive/MyDrive/DeepLearning/amlo_complete.csv')


df.head()

df = df.head(50)
df.reset_index(inplace=True)

df

!pip install langchain

! pip install openai==0.28.1

import os
os.environ['OPENAI_API_KEY']

from langchain.chat_models import ChatOpenAI

llm = ChatOpenAI(model_name= "gpt-3.5-turbo")

from langchain.schema.messages import HumanMessage, SystemMessage
prompt='''
You are a virtual assistant that classifies only texts in Spanish. The classifications that you should take into account are:
Security: talk about security in Mexico
History: facts from the history of Mexico or the world, no comments.
Economy: Refers to the economic situation in Mexico.
Foreign: Talk about how other countries get involved with Mexico or how Mexico impacts abroad, also about migration.
Opinion: People's personal opinion on any topic, mostly opinions about history in the actual society.
Health: Health situation in Mexico.
Support: social and financial support to communities, older adults, indigenous people, etc.
Corruption: About the wrongdoings of other groups or organizations.
Opposition: Opposed to certain ideas or thoughts, even opposition or badmouthing about a person, organization or Politics People.
Construction: Infrastructure built or purchased for the betterment of Mexico.


The answer should only be one word in Spanish, not English.

'''

def clasificate_csv(text):

        response = llm.invoke(
                [SystemMessage(content=prompt), HumanMessage(content=text)]
            )
        return response.content

df["new_clasification"] = df["Texto"].apply(clasificate_csv)
print("acabo")

df.to_csv('amlo_clasify_chatpgt2.csv', index=False)

