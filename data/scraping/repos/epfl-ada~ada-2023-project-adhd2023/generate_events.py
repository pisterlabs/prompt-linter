from openai import OpenAI
import os
import time


#set up the API key (hidden)
client = OpenAI(api_key="sk...")

# Define a function to fetch events for a given year
def fetch_events_for_year(year):
    """
    This function interacts with the OpenAI GPT-4 model to generate information about the top events of a specified year.

    Parameters:
    - year (int): The year for which events are to be fetched.

    Returns:
    - str: A string containing information about the top events of the specified year.
    """

    # Construct a prompt string with specific instructions for the model
    prompt = f"I want you to respond in this way : year|event name|event description|country code|event category|..." \
             " [instructions continue] : what is the top 8 most marking events of the year {year} ?" \
             " (make 10 events for each year, I want the description to have about 70 words," \
             " the event location to be a country, the event category to be a little general." \
             " Don't make an introduction and don't forget the | between the events and at the end." \
             " For the event category, I want it to be in this set:[Political Events, Military Conflicts," \
             " Social Movements, Economic Events, Science and health advancement, Cultural Events," \
             " Space Exploration, Sporting Events]. Give the most significant events and don't focus on making" \
             " the categories number equal."

    # Make a call to the OpenAI API for response generation
    response = client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "user", "content": prompt}
        ]
    )

    # Extract the content from the response generated by the model
    content = response.choices[0].message.content

    # Return the content as the result of the function
    return content


# Create a file to save the concatenated events
with open('historical_events_new.txt', 'a') as file:
    # Iterate over the years for which we want to fetch events
    for year in range(1820, 2014):
        # Fetch the events for the year
        events = fetch_events_for_year(year)
        # Save to the file
        file.write(events)
        
        # print the progress
        print(f"Events for {year} written to file.")
        
        #sleep for 0.05 seconds
        time.sleep(0.05)

# Print completion message
print("All events fetched and saved to file.")
